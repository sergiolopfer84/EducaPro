<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistente de IA</title>
    <link rel="stylesheet" th:href="@{/styles/styles.css}" />
</head>
<body>

<div id="chat-container">
    <h2>Asistente de IA</h2>
    <div id="chat-box"></div>
    <input type="text" id="user-input" placeholder="Escribe tu pregunta...">
    <button onclick="enviarMensaje()">Enviar</button>
</div>

<script>
    function enviarMensaje() {
        let input = document.getElementById("user-input");
        let mensaje = input.value.trim();
        if (mensaje === "") return;

        let chatBox = document.getElementById("chat-box");

        // Agregar mensaje del usuario
        let userMessage = document.createElement("div");
        userMessage.classList.add("mensaje", "usuario");
        userMessage.innerHTML = `<strong>TÃº:</strong> ${mensaje}`;
        chatBox.appendChild(userMessage);
        chatBox.scrollTop = chatBox.scrollHeight;

        fetch('/api/chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                [window.csrf.headerName]: window.csrf.token
            },
            body: JSON.stringify(mensaje)
        })
        .then(response => response.text())
        .then(data => {
            // Agregar respuesta de la IA con color azul
            let aiMessage = document.createElement("div");
            aiMessage.classList.add("mensaje", "ia");
            aiMessage.innerHTML = `<strong>IA:</strong> ${data}`;
            chatBox.appendChild(aiMessage);
            chatBox.scrollTop = chatBox.scrollHeight;
        });

        input.value = "";
    }
</script>

<script>
    window.csrf = {
        token: '[[${csrfToken.token}]]',
        headerName: '[[${csrfToken.headerName}]]'
    };
</script>

</body>
</html>
